<head>
 <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
</head>
<body>




<button onclick="aapneEmnerFunction()">Åpne emner</button>
<button onclick="alleEmnerFunction()">Alle emner</button>



 <p>
 <select id="filter" class="emner" stye="background-color: #DB3F3D">	  
  			<option class="emner" value="0" style="font: bold";>Vis alle institutt</option>
			<option class="emner" value="11">Sosiologisk institutt</option>
			<option class="emner" value="12">Institutt for politikk og forvaltning</option>
			<option class="emner" value="13">Institutt for sammenliknende politikk</option>
			<option class="emner" value="15">Institutt for økonomi</option>
			<option class="emner" value="17">Institutt for informasjons- og medievitenskap</option>
			<option class="emner" value="34">Institutt for sosialantropologi</option>
			<option class="emner" value="41">Institutt for geografi</option>
		</select>
		</p>
		<script>
		
    $('#filter').change(function() {
			var port = $(this).val()
			console.log( port )
	    		if ( port == '0' ) {
				$("tr").css('display', 'table-row');
			} 
			else if ( port !== '' ) {
				$("tr[data-instituttnr!=" + port+ "]").css('display', 'none');
				$("tr[data-instituttnr=" + port+ "]").css('display', 'table-row');
				$("tr[data-port=stay]").css('display', 'table-row');
			} 
	    		else {
				$("tr").css('display', 'table-row');
			}
		});
    </script>

<div id="emner"></div>

</body>

<script>

var semdato = new Date();
	var dd = String(semdato.getDate()).padStart(2, '0');
	var mm = String(semdato.getMonth() + 1).padStart(2, '0'); //January is 0!
	var yyyy = semdato.getFullYear();

		if (dd >= 01 	&&	mm	== 	12) 	{ semester = yyyy+1	+	"v";}
		if (			mm	< 	06) 	{ semester = yyyy	+	"v";}
		if (dd <  15 	&& 	mm 	== 	06) 	{ semester = yyyy	+	"v";}
		if (dd >= 15 	&&	mm 	== 	06) 	{ semester = yyyy	+	"h";}
		if (			mm	> 	06 === 12) 	{ semester = yyyy	+	"h";}
		
		if (dd >= 01 	&&	mm	== 	12) 	{ semestertekst = "våren " + (yyyy+1)	;}
		if (			mm	< 	06) 	{ semestertekst = "våren " + yyyy	;}
		if (dd <  15 	&& 	mm 	== 	06) 	{ semestertekst = "våren " + yyyy	;}
		if (dd >= 15 	&&	mm 	== 	06) 	{ semestertekst = "høsten " + yyyy	;}
		if (			mm	> 	06 === 12) 	{ semestertekst = "høsten " + yyyy	;}

	const fakultet = ['15']
	const api_url = "https://fs.data.uib.no/KEYuxumaqu6u/json/littl_emne/"	+	semester;
  
async function getData() {
	
  const semUrl = await (await fetch(api_url)).json()
	const emne = semUrl.emne
 	const emneFilter = emne.filter( i => fakultet.includes( i.faknr_reglement ) );
  var emnekoder = [];
        emneFilter.forEach(function (emneFilter) {
            emnekoder.push(emneFilter.emnekode);
        })
  

  return emnekoder
  }
  
  
function alleEmnerFunction() {
getData()

  .then(emnner => {
  console.log(emnner)

      Promise.all(
        emnner.map(p=>fetch('https://fs-pres.data.uib.no/KEYuxumaqu6u/emne/'+p+'/info.json').then(r=>r.json())) 
      )

  .then(alleEmner=> {
     /*     console.log(results); */

	
	const emneData = alleEmner
      let tab = ``;
      for (let e of emneData) {
            tab += ` 
            				<tr data-instituttnr="${e.sted[1].instituttnr}"> 
                        <td >${e.emneid.emnekode}</td>   
                        <td >${e.emnenavn}</td>   
                        <td >${e.studierettkrav}</td>
                        <td >${e.studiepoeng}</td> 
                        <td >${e.sted[1].navn}</td> 
                        <td >${e.sted[1].instituttnr}</td> 		
                    </tr>`
                              }
        const resultat = `<table> 
                            <thead stype="color: #FFFFFF">
                               <tr data-port="stay" style="hight:20px">
                                    <th class="col1">Emnekode</th>
                                    <th class="col2">Emnenavn</th>
                                    <th class="col3">studierettkrav</th>
                                    <th class="col1">studiepoeng</th>
                                    <th class="col2">institutt</th>
                                    <th class="col3">instituttnr</th>
                               </tr>
                              </thead>`
                         + tab 
                         + `</table>`
        /* document.getElementById("emner").innerHTML = resultat;	*/

    document.getElementById("emner").innerHTML = resultat;


        }	
      );

  })
}

function aapneEmnerFunction() {
  getData()

  .then(emnner => {
  console.log(emnner)

      Promise.all(
        emnner.map(p=>fetch('https://fs-pres.data.uib.no/KEYuxumaqu6u/emne/'+p+'/info.json').then(r=>r.json())) 
      )

  .then(alleEmner=> {
     /*     console.log(results); */

	const status = 'false'
	const emnerStudierettkrav = alleEmner.filter( i => status.includes( i.studierettkrav ) );
	const emneData = emnerStudierettkrav
      let tab = ``;
      for (let e of emneData) {
            tab += `<tr data-year="${e.sted[1].instituttnr}> 
                        <td >${e.emneid.emnekode}</td>   
                        <td >${e.emnenavn}</td>   
                        <td >${e.studierettkrav}</td>
                        <td >${e.studiepoeng}</td> 
                        <td >${e.sted[1].navn}</td> 
                        <td >${e.sted[1].instituttnr}</td> 		
                    </tr>`
                              }
        const resultat = `<table> 
                            <thead stype="color: #FFFFFF">
                               <tr data-port="stay" style="hight:20px">
                                    <th class="col1">Emnekode</th>
                                    <th class="col2">Emnenavn</th>
                                    <th class="col3">studierettkrav</th>
                                    <th class="col1">studiepoeng</th>
                                    <th class="col2">institutt</th>
                                    <th class="col3">instituttnr</th>
                               </tr>
                              </thead>`
                         + tab 
                         + `</table>`
        /* document.getElementById("emner").innerHTML = resultat;	*/

    document.getElementById("emner").innerHTML = resultat;


        }	
      );

  })
}
</script>
<script>

</script>
