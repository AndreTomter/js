<head>
<style>
.visible {display: none}
.new-class {display: none}
.toggle {
  color:white;
  font-size:20px;
  width:30px;
  height:30px;
  background-color: #fff;
  display: block;
  text-align:center;
  position: relative;
  border: 1px solid transparent;
  background: #9E9E9E;
}
.filterSted {
  display: block;
  margin-left: 1em;
  font-size:20px;
}
</style>
<script>

var semdato = new Date();
	var dd = String(semdato.getDate()).padStart(2, '0');
	var mm = String(semdato.getMonth() + 1).padStart(2, '0'); //January is 0!
	var yyyy = semdato.getFullYear();

		if (dd >= 01 	&&	mm	== 	12) 	{ semester = yyyy+1	+	"v";}
		if (			mm	< 	06) 	{ semester = yyyy	+	"v";}
		if (dd <  15 	&& 	mm 	== 	06) 	{ semester = yyyy	+	"v";}
		if (dd >= 15 	&&	mm 	== 	06) 	{ semester = yyyy	+	"h";}
		if (			mm	> 	06 === 12) 	{ semester = yyyy	+	"h";}
		
		if (dd >= 01 	&&	mm	== 	12) 	{ semestertekst = "våren " + (yyyy+1)	;}
		if (			mm	< 	06) 	{ semestertekst = "våren " + yyyy	;}
		if (dd <  15 	&& 	mm 	== 	06) 	{ semestertekst = "våren " + yyyy	;}
		if (dd >= 15 	&&	mm 	== 	06) 	{ semestertekst = "høsten " + yyyy	;}
		if (			mm	> 	06 === 12) 	{ semestertekst = "høsten " + yyyy	;}

	const fakultet = ['15']
	const api_url = "https://fs.data.uib.no/KEYuxumaqu6u/json/littl_emne/"	+	semester;
  
async function getData() {
	
  const semUrl = await (await fetch(api_url)).json()
	const emne = semUrl.emne
 	const emneFilter = emne.filter( i => fakultet.includes( i.faknr_reglement ) );
  var emnekoder = [];
        emneFilter.forEach(function (emneFilter) {
            emnekoder.push(emneFilter.emnekode);
        })
  

  return emnekoder
  }
  
  

getData()

  .then(emnner => {
  console.log(emnner)

      Promise.all(
        emnner.map(p=>fetch('https://fs-pres.data.uib.no/KEYuxumaqu6u/emne/'+p+'/info.json').then(r=>r.json())) 
      )

  .then(alleEmner=> {
     /*     console.log(results); */

	
	const emneData = alleEmner
      let tab = ``;
      for (let e of emneData) {
            tab += ` 
            				<tr class = "row ${e.studierettkrav} ${e.sted[1].instituttnr}"> 
                        <td >${e.emneid.emnekode}</td>   
                        <td >${e.emnenavn}</td>   
                        <td >${e.studierettkrav}</td>
                        <td >${e.studiepoeng}</td> 
                        <td >${e.sted[1].navn}</td> 
                        <td >${e.sted[1].instituttnr}</td> 		
                    </tr>`
                              }
        const resultat = `<table id="myTable"> 
                            <thead stype="color: #FFFFFF">
                               <tr data-port="stay" style="hight:20px">
                                    <th class="col1">Emnekode</th>
                                    <th class="col2">Emnenavn</th>
                                    <th class="col3">studierettkrav</th>
                                    <th class="col1">studiepoeng</th>
                                    <th class="col2">institutt</th>
                                    <th class="col3">instituttnr</th>
                               </tr>
                              </thead>`
                         + tab 
                         + `</table>`
        /* document.getElementById("emner").innerHTML = resultat;	*/

    document.getElementById("emner").innerHTML = resultat;


        }	
        
      );

  })


</script>

</head>
<body>
<div style="display: flex; align-items: center;">
<div class="toggle" >✓</div>
<div class="filterSted">
<select onclick="myStedfilterFunction()" >
      <option value='row'>Vis alle institutt</option>
			<option value="11">Sosiologisk institutt</option>
			<option value="12">Institutt for politikk og forvaltning</option>
			<option value="13">Institutt for sammenliknende politikk</option>
			<option value="15">Institutt for økonomi</option>
			<option value="17">Institutt for informasjons- og medievitenskap</option>
			<option value="34">Institutt for sosialantropologi</option>
			<option value="41">Institutt for geografi</option>
</select>
</div>
</div>
<div id="emner"></div>
<script>
var elements=document.getElementsByClassName('toggle')
function handler(el){
el[i].addEventListener('click',
function(e){

e.target.innerHTML==''?e.target.innerHTML='✓':e.target.innerHTML='';
},false)
}
for(var i=0;i<elements.length;++i){
handler(elements)
}


const buttonToggle = document.querySelector('.toggle');
buttonToggle.addEventListener('click', toggleClass);


function toggleClass(){
  const element = [...document.querySelectorAll('.false')];
  for (const e of element) {
  e.classList.toggle('new-class');
}
}


function myStedfilterFunction() {
let selectedFilters = [];
const images = [...document.querySelectorAll('.row')];
const filters = [...document.querySelectorAll('.filterSted select')];

for (const filter of filters) {
  filter.addEventListener('change', function(event) {
    selectedFilters = filters.map(filter => filter.value).filter(Boolean);
    console.log(selectedFilters);
    for (const image of images) {
      image.classList[selectedFilters.some(filter => image.classList.contains(filter)) 
        ? 'remove'
        : 'add']('visible');
    }
  })
}
}
</script>
</body>

