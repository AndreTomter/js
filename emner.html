<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
	<style>
		table { width: 70%; border: 1px solid gray; border-collapse: collapse; }
		td { border: 1px solid gray; padding: 4px; }
		tr.hidden { display: none; }
		#tab tr.alt { background-color: #ddd;}
	</style>
	<script>
		
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script>
     	var semdato = new Date();
	var dd = String(semdato.getDate()).padStart(2, '0');
	var mm = String(semdato.getMonth() + 1).padStart(2, '0'); //January is 0!
	var yyyy = semdato.getFullYear();

		if (dd >= 15 	&&	mm	== 	12) 	{ semester = yyyy+1	+	"V";}
		if (			mm	< 	06) 	{ semester = yyyy	+	"V";}
		if (dd <  15 	&& 	mm 	== 	06) 	{ semester = yyyy	+	"V";}
		if (dd >= 15 	&&	mm 	== 	06) 	{ semester = yyyy	+	"H";}
		if (			mm	> 	06) 	{ semester = yyyy	+	"H";}
	
	//fakultet som skal vises
	const fakultet = ['15']

	// api url
	const api_url = "https://fs.data.uib.no/KEYuxumaqu6u/json/littl_emne/"	+	semester;

	// Defining async function
	async function getapi(url)	{

	// Storing response
	const response = await fetch(url);

	// Storing data in form of JSON
	const data = await response.json();
  	
	// filtrerer listen	
	const emne = data.emne.filter( i => fakultet.includes( i.faknr_reglement ) );
  	
	//sorterer alfabetisk
	const sortert = emne.sort( function( a, b )
  	{
		a = a.emnekode.toLowerCase();
      		b = b.emnekode.toLowerCase();
      		return a < b ? -1 : a > b ? 1 : 0;
	});
   
	console.log(sortert)
   
   	show(sortert)
   
  					}
  	
	getapi(api_url)
  
  	function show(sortert) {
		let tab =
			`<thead stype="color: #FFFFFF"><tr data-port="stay">
				<th>Emnekode</th>
				<th>Emnenavn</th>
				<th>Studiepoeng</th>
			</tr></thead>`;
	
		// Loop to access all rows
		for (let r of sortert) {
        	tab += `<tr class="fnr-${r.faknr_reglement}" data-port="${r.faknr_reglement}${r.instituttnr_reglement}"> 
				<td ><a href="http://www.uib.no/emne/${r.emnekode}">${r.emnekode}</a></td>   
				<td >${r.emnenavn_bokmal}</td>   
   				<td >${r.studiepoeng} sp</td>   
			</tr>`;
					}
	
	// Setting innerHTML as tab variable
	document.getElementById("emner").innerHTML = tab;
				}
	document.addEventListener('DOMContentLoaded', function () {
    		let table = new DataTable('#example');
								});
	
  	table = document.getElementById("emner");	
	
	</script>
		
</head>
<body>
	<h1>Emner som overføres til Canvas</h1>
				
		<p> Lister ut undervisningsenheter som overføres til Canvas </p>
		<p> Endrer semester 15 desember og 15 juni </p>
		<p> Korrekt sortering av emnene i stigende rekkefølge gjennstår </p>
						     
		<select class="dropbtn dropdown" id="filter">
				  
  			<option class="dropdown-content skjul" value="valg" style="color: #ffffff; font: bold"; hidden selected>Velg institutt</option>
			<option class="dropdown-content" value="1511">Sosiologisk institutt</option>
			<option class="dropdown-content" value="1512">Institutt for politikk og forvaltning</option>
			<option class="dropdown-content" value="1513">Institutt for sammenliknende politikk</option>
			<option class="dropdown-content" value="1515">Institutt for økonomi</option>
			<option class="dropdown-content" value="1517">Institutt for informasjons- og medievitenskap</option>
			<option class="dropdown-content" value="1534">Institutt for sosialantropologi</option>
			<option class="dropdown-content" value="1541">Institutt for geografi</option>

		</select>
		<script>
	var tab = document.getElementById("emner"), 
	btns = tab.getElementsByTagName("a"), 
	show = document.getElementById("show"), 
	rows
;

stripe(); // Stripe the rows in beginning

// The stripe function itself
function stripe() {
    // select all rows which are not hidden
	rows = tab.querySelectorAll('tr:not(.hidden)');
  
    // add a class for every second such row
	for(var x = 0; x < rows.length; x++) {
    	if (x % 2 == 0) { rows[x].classList.add('alt'); }
		else { rows[x].classList.remove('alt'); }
	}
}
			
		$('#filter').change(function() {
			var port = $(this).val()
			console.log( port )
			if ( port !== '' ) {
				$("tr[data-port!=" + port+ "]").css('visibility', 'collapse');
				$("tr[data-port=" + port+ "]").css('visibility', 'visible');
				$("tr[data-port=stay]").css('visibility', 'visible');
			} else {
				$("tr").css('visibility', 'visible');
			}
		});	
		</script>

	<table id="emner" class="stripe hover" style="max-height:400px;"></table>
</body>
</html>
